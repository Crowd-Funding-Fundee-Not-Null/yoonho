<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-/mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 매퍼 파일 위치 -->
<mapper namespace="com.fundee.mapper.BuyMapper">

<!-- 구매번호 -->
<select id="maxNumber" resultType="int">
select nvl(max(buy_no),0) from buy_list
</select>


<!-- 결제하기 눌렀을때 저장되는 정보 -->
<insert id="insertData" parameterType="com.fundee.dto.BuyListDTO">
	insert into buy_list (buy_no, buy_date, id, posts_num, qty, buy_price, total_price, name)
	 values (buy_no_seq.nextval, sysdate, #{id}, #{posts_num}, #{qty}, #{buy_price}, #{total_price},
	 #{name})
</insert>


<!-- 구매창에서 수량만 변경해서 저장 -->
<update id="updateQty" parameterType="com.fundee.dto.BuyListDTO">
	update buy_list set qty = #{qty} 
	where buy_no = #{buy_no}
</update>


<!-- 구매번호로 찾아서 구매제품,수량, 받을주소, 이름 출력.
*파라미터 타입이란: 쿼리가 실행될때 필요한 객체인데 여기에 쓴
변수들은 sql쿼리#{}안에 들어가는 변수명과 일치해야한다. 
한개 데이터만 출력 -->
<select id="checkData" parameterType="int"
	resultType="com.fundee.dto.BuyListDTO">
	select a.title, a.qty, b.price, a.buy_price, c.name, c.add 
	from buy_list a right outer join posts b on a.title = b.title 
	left outer join member c on a.id = c.id 
	where a.buy_no=#{buy_no }
</select>


<!-- 이거는 수량만 변경해서 저장하는 기능으로 바꿔야 할것같아 -->		
<!-- 마이페이지에서 사용하는 구매자 아이디로 찾아서 전체구매내역 출력(꾸러미닷)
구매한 상품, 수량, 총결제금액, 구매일자 텍스트 출력 -->	
		
<select id="getMyDataList" parameterType="String"
	resultType="com.fundee.dto.BuyListDTO">
	
	select buy_date, posts_num, qty, buy_price, total_price   
	from buy_list where id=#{id} order by buy_date desc
</select>



<!-- 상페에서 결제하기 버튼 눌렀을때 - 구매할 상품 및 수량 저장
//반환값 없이 데이터 저장 기능
<insert id="buyDATA" parameterType="com.fundee.dto.BuyListDTO">
	insert into buy_list (buy_no,buy_date,id,title,qty,
	buy_price) values (#{buyNumber}, sysdate,#{id},
	#{title},#{qty},(#{qty}*(select price from posts where title=#{title})))
</insert> -->
			
		

</mapper>